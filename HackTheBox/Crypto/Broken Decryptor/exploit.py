from pwn import *

def get_opt():
    io.sendlineafter(b": ", b"1")
    return bytes.fromhex(io.recvline().strip().decode())

def encrypt(_len):
    io.sendlineafter(b": ", b"2")
    io.sendlineafter(b": ", bytes(_len).hex().encode())
    return bytes.fromhex(io.recvline().strip().decode())


if __name__ == "__main__":
    io = remote("157.245.43.189", 31764)
    # io = remote("0", 1337)
    
    io.sendlineafter(b": ", b"1")
    N   = len(bytes.fromhex(io.recvline().strip().decode())  )  
    enc_flag = [set() for _ in range(N)]
    key_str  = [set() for _ in range(N)]
    
    cnt = 0
    while True:
        cnt += 1
        ct1 = get_opt()
        ct2 = encrypt(N)
        for i in range(N):
            enc_flag[i].add(ct1[i])
            key_str[i].add(ct2[i])

        if cnt%20 == 0:
            print("[DEBUG]:", [len(f) for f in enc_flag])
            print("[DEBUG]:", [len(f) for f in key_str])
            print("="*100)

        if all(len(f) == 255 for f in enc_flag) and all(len(k) == 255 for k in key_str):
            break
    
    U = set(list(range(256)))
    enc_flag = bytes([(U - f).pop() for f in enc_flag])
    key_str  = bytes([(U - k).pop() for k in key_str])
    flag     = xor(enc_flag, key_str)
    print("[+] Flag:", flag.decode())
