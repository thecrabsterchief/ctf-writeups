from sage.all import *
from Crypto.Util.number import *
from Crypto.PublicKey import RSA
from base64 import b64decode

N = []
E = []
C = []

def load_data(path_key, path_ct):
    global N, E, C

    with open(path_key, "r") as f:
        key = RSA.importKey(f.read())
        N += [key.n]; E += [key.e]
    with open(path_ct, "r") as f:
        C += [bytes_to_long(b64decode(f.read().strip()))]

if __name__ == '__main__':
    load_data("./key1_pub.pem", "./message1")
    load_data("./key2_pub.pem", "./message2")

    assert N[0] == N[1]
    _, u, v = xgcd(E[0], E[1])
    assert _ == 1

    m = pow(C[0], u, N[0]) * pow(C[1], v, N[0]) % N[0]
    print(long_to_bytes(int(m)))
